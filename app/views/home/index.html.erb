<h1 class="dashboard-title">ダッシュボード</h1>

<%# ----- 成長記録(グラフ) ----- %>
<div class="stats">
  <% if @latest_height && @latest_weight %>
    <p>最新身長: <strong><%= @latest_height %> cm</strong> (<%= @height_diff >= 0 ? "+" : "" %><%= @height_diff %>)</p>
    <p>最新体重: <strong><%= @latest_weight %> kg</strong> (<%= @weight_diff >= 0 ? "+" : "" %><%= @weight_diff %>)</p>
    <p>平均身長: <strong><%= @avg_height %> cm</strong></p>
    <p>平均体重: <strong><%= @avg_weight %> kg</strong></p>
  <% else %>
    <p>成長記録はまだ登録されていません。</p>
  <% end %>
</div>

<canvas id="dashboardChart" data-growths='<%= raw @growths_for_chart.to_json %>'></canvas>

<%# ----- スケジュール一覧（直近5件） ----- %>
<h2 class="dashboard-title">スケジュール（直近）</h2>
<table class="dashboard-table dashboard-schedule-table">
  <thead>
    <tr>
      <th class="dashboard-schedule-col-date">日時</th>
      <th class="dashboard-schedule-col-title">タイトル</th>
      <th class="dashboard-schedule-col-detail">詳細</th>
    </tr>
  </thead>
  <tbody>
    <% @schedules.each do |schedule| %>
      <tr>
        <td class="dashboard-schedule-col-date">
          <%= schedule.start_time.strftime("%m/%d") %>
          <% if schedule.all_day %>
            終日
          <% else %>
            <%= schedule.start_time.strftime(" %H:%M") %>
            <% if schedule.end_time %>
              〜<%= schedule.end_time.strftime("%H:%M") %>
            <% end %>
          <% end %>
        </td>
        <td class="dashboard-schedule-col-title"><%= schedule.title %></td>
        <td class="dashboard-schedule-col-detail"><%= schedule.memo %></td>
      </tr>
    <% end %>
    <% if @schedules.empty? %>
      <tr>
        <td colspan="3">スケジュールはありません</td>
      </tr>
    <% end %>
  </tbody>
</table>

<%# ----- 育児記録一覧 ----- %>
<h2 class="dashboard-title">育児記録一覧</h2>

<div class="flex justify-center items-center mb-4">
  <div class="flex items-center gap-4">
    <!-- 前日へ -->
    <div class="tooltip">
      <%= link_to root_path(date: (@selected_date - 1.day).to_s), class: "text-gray-600 hover:text-gray-800" do %>
        <i class="fa-solid fa-chevron-left text-lg"></i>
        <span class="tooltip-text">前日へ</span>
      <% end %>
    </div>

    <!-- 日付表示 -->
    <span class="text-lg font-semibold text-gray-800">
      <%= @selected_date.strftime("%Y年%m月%d日") %> の記録
    </span>

    <!-- 翌日へ（本日より未来の場合は非表示） -->
    <div class="tooltip">
      <% if @selected_date < Date.current %>
        <%= link_to root_path(date: (@selected_date + 1.day).to_s), class: "text-gray-600 hover:text-gray-800" do %>
          <i class="fa-solid fa-chevron-right text-lg"></i>
          <span class="tooltip-text">翌日へ</span>
        <% end %>
      <% end %>
    </div>

    <!-- 📅 カレンダー選択 -->
<div class="relative">
  <!-- 隠しinput -->
  <input type="date" id="calendar-input"
    class="absolute opacity-0 pointer-events-none"
    value="<%= @selected_date %>"
    max="<%= Date.current %>">
    

  <!-- ボタン（クリックでinputを呼び出す） -->
  <button
    id="calendar-button"
    class="ml-2 px-3 py-1.5 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg border border-gray-300 hover:bg-gray-200 transition duration-200 flex items-center gap-1">
    <i class="fa-solid fa-calendar-days"></i> 日付選択
  </button>
</div>

    <!-- 🟢 本日へ（過去・未来の日付時のみ表示） -->
<% if @selected_date != Date.current %>
  <%= link_to "本日へ", root_path,
    class: "ml-4 px-3 py-1.5 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg border border-gray-300 hover:bg-gray-200 transition duration-200 no-underline hover:no-underline" %>
<% end %>
  </div>
</div>

<table class="dashboard-table">
  <thead>
    <tr>
      <th class="dashboard-col-item">項目</th>
      <th class="dashboard-col-date">日時</th>
      <th class="dashboard-col-detail">詳細1</th>
      <th class="dashboard-col-detail">詳細2</th>
      <th class="dashboard-col-memo">メモ</th>
      <th class="dashboard-col-chevron"></th>
    </tr>
  </thead>

  <tbody id="dashboard-records">
    <% if @records.any? %>
      <%= render partial: "home/record_row", collection: @records, as: :record %>
    <% else %>
      <tr>
        <td colspan="6" class="text-center text-gray-500 py-4">
          <% if @selected_date == Date.current %>
            本日の記録がまだありません。
          <% else %>
            記録がありません。
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>