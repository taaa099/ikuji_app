<h1>ダッシュボード</h1>

<table border="1" cellpadding="5" cellspacing="0">
  <thead>
    <tr>
      <th>項目</th>
      <th>日時</th>
      <th>詳細1</th>
      <th>詳細2</th>
      <th>メモ</th>
    </tr>
  </thead>
  <tbody>
    <% model_names = {
      "Feed" => "授乳",
      "Diaper" => "おむつ",
      "Bottle" => "ミルク",
      "Hydration" => "水分補給",
      "BabyFood" => "離乳食",
      "SleepRecord" => "睡眠",
      "Temperature" => "体温",
      "Bath" => "お風呂",
      "Vaccination" => "予防接種"
    } %>

    <% @records.each do |record| %>
      <tr>
        <td><%= model_names[record.class.name] || record.class.name %></td>
        <td>
          <% 
            date_columns = {
              "Feed" => :fed_at,
              "Diaper" => :changed_at,
              "Bottle" => :given_at,
              "Hydration" => :fed_at,
              "BabyFood" => :fed_at,
              "SleepRecord" => :start_time,
              "Temperature" => :measured_at,
              "Bath" => :bathed_at,
              "Vaccination" => :vaccinated_at
            }
            date_col = date_columns[record.class.name]
            datetime = record.send(date_col)
          %>
          <%= datetime ? datetime.strftime("%Y-%m-%d %H:%M") : "日時なし" %>
        </td>
        <% case record.class.name %>
        <% when "Feed" %>
          <td><% left_min = record.left_time / 60 %>
            <% left_sec = record.left_time % 60 %>
            左：<%= "#{left_min}分#{left_sec}秒" %>
          </td>
          <td>
            <% right_min = record.right_time / 60 %>
            <% right_sec = record.right_time % 60 %>
            右：<%= "#{right_min}分#{right_sec}秒" %>
          </td>
          <td><%= record.memo %></td>
        <% when "Diaper" %>
          <td><% pee = record.pee? %>
            <% poop = record.poop? %>
            <% if pee && poop %>
              両方
            <% elsif pee %>
              おしっこあり
            <% elsif poop %>
              うんちあり
            <% else %>
              なし
            <% end %>
          </td>
          <td></td>
          <td><%= record.memo %></td>
        <% when "Bottle" %>
          <td><%= record.amount %>ml</td>
          <td></td>
          <td><%= record.memo %></td>
        <% when "Hydration" %>
          <td><%= record.drink_type %></td>
          <td><%= record.amount %>ml</td>
          <td><%= record.memo %></td>
        <% when "BabyFood" %>
          <td><%= record.amount %>ml</td>
          <td></td>
          <td><%= record.memo %></td>
        <% when "SleepRecord" %>
          <td><%= record.start_time.strftime("%H:%M") if record.start_time %>〜<%= record.end_time.strftime("%H:%M") if record.end_time %></td>
          <td>
            <% if record.start_time && record.end_time %>
              <% duration_in_seconds = record.end_time - record.start_time %>
              <% hours = (duration_in_seconds / 3600).floor %>
              <% minutes = ((duration_in_seconds % 3600) / 60).round %>
              <%= "#{hours}時間#{minutes}分" %>
            <% else %>
              記録なし
            <% end %>
          </td>
          <td><%= record.memo %></td>
        <% when "Temperature" %>
          <td><%= sprintf("%.1f", record.temperature) %>(℃)</td>
          <td></td>
          <td><%= record.memo %></td>
        <% when "Bath" %>
          <td><%= record.bath_type %></td>
          <td></td>
          <td><%= record.memo %></td>
        <% when "Vaccination" %>
          <td><%= record.vaccine_name %></td>
          <td></td>
          <td></td>
        <% else %>
          <td colspan="2"><%= record.respond_to?(:memo) ? record.memo : "-" %></td>
          <td></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>