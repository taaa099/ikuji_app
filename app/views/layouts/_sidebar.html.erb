<div class="sidebar">
  <ul>
    <li class="tooltip">
      <%= link_to root_path, class: "flex items-center gap-2" do %>
        <i class="fa-solid fa-chess-board text-gray-600 text-xl"></i>
        <span>ダッシュボード</span>
        <span class="tooltip-text">ダッシュボード</span>
      <% end %>
    </li>

    <li class="tooltip">
      <%= link_to children_path, class: "flex items-center gap-2" do %>
        <i class="fa-solid fa-child text-gray-600 text-xl"></i>
        <span>子供一覧</span>
        <span class="tooltip-text">子供一覧</span>
      <% end %>
    </li>

    <li>
      <div class="tooltip">
        <button id="toggle-record-list" class="nav-btn">
          <i class="fa-solid fa-record-vinyl text-gray-600 text-xl"></i>
          <span>記録一覧</span>
          <i class="fa-solid fa-chevron-down text-gray-600 text-sm chevron" style="font-size:13px"></i>
        </button>
        <span class="tooltip-text">記録一覧 &#x25BC;</span>
      </div>

      <ul id="record-list-menu" class="hidden ml-4 space-y-1">
        <li>
          <%= link_to child_feeds_path(current_child), class: "flex items-center gap-2", data: { tooltip: "授乳一覧" } do %>
            <i class="fa-solid fa-person-breastfeeding text-gray-600 text-xl"></i>
            <span>授乳一覧</span>
          <% end %>
        </li>

        <li>
          <%= link_to child_diapers_path(current_child), class: "flex items-center gap-2", data: { tooltip: "おむつ一覧" } do %>
            <i class="fa-solid fa-baby text-gray-600 text-xl"></i>
            <span>おむつ一覧</span>
          <% end %>
        </li>

        <li>
          <%= link_to child_bottles_path(current_child), class: "flex items-center gap-2", data: { tooltip: "ミルク一覧" } do %>
            <i class="fa-solid fa-bottle-droplet text-gray-600 text-xl"></i>
            <span>ミルク一覧</span>
          <% end %>
        </li>

        <li>
          <%= link_to child_hydrations_path(current_child), class: "flex items-center gap-2", data: { tooltip: "水分補給一覧" } do %>
            <i class="fa-solid fa-bottle-water text-gray-600 text-xl"></i>
            <span>水分補給一覧</span>
          <% end %>
        </li>

        <li>
          <%= link_to child_baby_foods_path(current_child), class: "flex items-center gap-2", data: { tooltip: "離乳食一覧" } do %>
            <i class="fa-solid fa-utensils text-gray-600 text-xl"></i>
            <span>離乳食一覧</span>
          <% end %>
        </li>

        <li>
          <%= link_to child_sleep_records_path(current_child), class: "flex items-center gap-2", data: { tooltip: "睡眠一覧" } do %>
            <i class="fa-solid fa-moon text-gray-600 text-xl"></i>
            <span>睡眠一覧</span>
          <% end %>
        </li>

        <li>
          <%= link_to child_baths_path(current_child), class: "flex items-center gap-2", data: { tooltip: "お風呂一覧" } do %>
            <i class="fa-solid fa-bath text-gray-600 text-xl"></i>
            <span>お風呂一覧</span>
          <% end %>
        </li>

        <li>
          <%= link_to child_temperatures_path(current_child), class: "flex items-center gap-2", data: { tooltip: "体温一覧" } do %>
            <i class="fa-solid fa-temperature-three-quarters text-gray-600 text-xl"></i>
            <span>体温一覧</span>
          <% end %>
        </li>

        <li>
          <%= link_to child_vaccinations_path(current_child), class: "flex items-center gap-2", data: { tooltip: "予防接種一覧" } do %>
            <i class="fa-solid fa-syringe text-gray-600 text-xl"></i>
            <span>予防接種一覧</span>
          <% end %>
        </li>
      </ul>
    </li>

    <li class="tooltip">
      <%= link_to schedules_path, class: "flex items-center gap-2" do %>
        <i class="fa-solid fa-calendar text-gray-600 text-xl"></i>
        <span>スケジュール一覧</span>
        <span class="tooltip-text">スケジュール一覧</span>
      <% end %>
    </li>

    <li class="tooltip">
      <%= link_to analysis_child_sleep_records_path(current_child), class: "flex items-center gap-2" do %>
        <i class="fa-solid fa-chart-simple text-gray-600 text-xl"></i>
        <span>睡眠分析</span>
        <span class="tooltip-text">睡眠分析</span>
      <% end %>
    </li>

    <li class="tooltip">
      <%= link_to child_growths_path(current_child), class: "flex items-center gap-2" do %>
        <i class="fa-solid fa-arrow-up-right-dots text-gray-600 text-xl"></i>
        <span>成長記録</span>
        <span class="tooltip-text">成長記録</span>
      <% end %>
    </li>

    <li class="tooltip">
      <%= link_to diaries_path, class: "flex items-center gap-2" do %>
        <i class="fa-solid fa-book text-gray-600 text-xl"></i>
        <span>日記</span>
        <span class="tooltip-text">日記一覧</span>
      <% end %>
    </li>

    <li class="tooltip">
      <%= link_to tips_path, class: "flex items-center gap-2" do %>
        <i class="fa-solid fa-lightbulb text-gray-600 text-xl"></i>
        <span>育児のヒント</span>
        <span class="tooltip-text">育児のヒント</span>
      <% end %>
    </li>

    <li class="tooltip">
      <button id="toggle-notification-settings" class="nav-btn">
        <i class="fa-solid fa-bolt text-gray-600 text-xl"></i>
        <span>通知設定</span>
          <i class="fa-solid fa-chevron-down text-gray-600 text-sm chevron" style="font-size:13px"></i>
        <span class="tooltip-text">通知設定 &#x25B6;</span>
      </button>
    </li>
  </ul>

  <!-- =======================
       通知設定モーダル
       ======================= -->
  <div id="notification-modal" class="modal hidden">
    <div class="modal-content">
      <span id="close-notification-modal" class="modal-close">&times;</span>
      <div id="notification-settings-container">
        <div id="notification-settings-block" class="hidden">
          <% if current_user.present? %>
            <% current_user.notification_settings.each do |setting| %>
              <div class="notification-setting">
                <h5>
                  <% 
                    target_name = case setting.target_type
                    when "feed" then "授乳"
                    when "diaper" then "おむつ"
                    when "bottle" then "ミルク"
                    when "hydration" then "水分"
                    when "baby_food" then "離乳食"
                    when "sleep_record" then "睡眠"
                    when "temperature" then "体温"
                    when "bath" then "お風呂"
                    when "vaccination" then "予防接種"
                    when "schedule" then "スケジュール"
                    when "growth" then "成長記録"
                    else setting.target_type.humanize
                    end
                  %>
                  <%= target_name %>
                </h5>

                <!-- リマインダー関連は temperature の場合表示しない -->
                <% unless setting.target_type == "temperature" %>
                  <!-- リマインダーオンオフ -->
                  <label>
                    リマインダーON
                    <%= check_box_tag "reminder_switch_#{setting.id}",
                                      1,
                                      setting.reminder_on,
                                      data: { id: setting.id, field: "reminder_on" },
                                      class: "notification-switch" %>
                  </label>

                  <!-- リマインダー時間（1〜12時間） -->
                  <% if setting.reminder_after.present? %>
                    <label>
                      リマインダー通知時間（時間）
                      <%= number_field_tag "reminder_after_#{setting.id}",
                                           setting.reminder_after,
                                           min: 1,
                                           max: 12,
                                           data: { id: setting.id, field: "reminder_after" },
                                           class: "notification-number" %>
                    </label>
                  <% end %>
                <% end %>

                <!-- アラートオンオフ -->
                <label>
                  アラートON
                  <%= check_box_tag "alert_switch_#{setting.id}",
                                    1,
                                    setting.alert_on,
                                    data: { id: setting.id, field: "alert_on" },
                                    class: "notification-switch" %>
                </label>

                <!-- アラート時間・閾値（bottle と hydration は除外） -->
                <% if setting.alert_after.present? && !["bottle", "hydration"].include?(setting.target_type) %>
                  <label>
                    アラート通知時間（時間）
                    <%= number_field_tag "alert_after_#{setting.id}",
                                         setting.alert_after,
                                         min: 1,
                                         max: 6,
                                         data: { id: setting.id, field: "alert_after" },
                                         class: "notification-number" %>
                  </label>
                <% end %>

                <% if setting.alert_threshold.present? %>
                  <label>
                    アラート閾値
                    <%= number_field_tag "alert_threshold_#{setting.id}",
                                         setting.alert_threshold,
                                         step: 0.1,
                                         min: 35.0,
                                         max: 42.0,
                                         data: { id: setting.id, field: "alert_threshold" },
                                         class: "notification-number" %>
                  </label>
                <% end %>

                <% if setting.alert_time.present? %>
                  <label>
                    アラート時間
                    <%= select_tag "alert_time_#{setting.id}",
                                   options_for_select(
                                     (6..11).map { |h| ["#{h}:00", "#{h}:00"] },
                                     selected: setting.alert_time&.strftime("%H:%M")
                                   ),
                                   data: { id: setting.id, field: "alert_time" },
                                   class: "notification-time" %>
                  </label>
                <% end %>

                <!-- Daily Goal 入力 -->
                <% if current_child.present? %>
                  <% case setting.target_type %>
                  <% when "bottle" %>
                    <label>
                      1日あたりのボトル目標 (ml)
                      <%= number_field_tag "daily_bottle_goal_#{current_child.id}",
                                           current_child.daily_bottle_goal,
                                           min: 0,
                                           step: 1,
                                           data: { child_id: current_child.id, field: "daily_bottle_goal" },
                                           class: "child-goal" %>
                    </label>
                  <% when "hydration" %>
                    <label>
                      1日あたりの水分目標 (ml)
                      <%= number_field_tag "daily_hydration_goal_#{current_child.id}",
                                           current_child.daily_hydration_goal,
                                           min: 0,
                                           step: 1,
                                           data: { child_id: current_child.id, field: "daily_hydration_goal" },
                                           class: "child-goal" %>
                    </label>
                  <% when "baby_food" %>
                    <label>
                      1日あたりの離乳食目標 (g)
                      <%= number_field_tag "daily_baby_food_goal_#{current_child.id}",
                                           current_child.daily_baby_food_goal,
                                           min: 0,
                                           step: 1,
                                           data: { child_id: current_child.id, field: "daily_baby_food_goal" },
                                           class: "child-goal" %>
                    </label>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>