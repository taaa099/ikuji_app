<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Ikuji App" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "sidebar", "records", "schedule", "dashboard", "growth", "sleep_analysis", "diary", "user_settings/profile", "user_settings/darkmode", "modals", "notification", "tips", "swich_child_page", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
    <%= javascript_importmap_tags %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
  </head>
  <body data-current-child-id="<%= @current_child&.id || 0 %>" class="bg-white text-black dark:bg-gray-900 dark:text-gray-100">
    <header class="site-header">
      <% if user_signed_in? %>
        <div class="header-container flex justify-between items-center">
          <!-- 左端ロゴ -->
          <div class="header-logo">
            <%= link_to "IkujiApp", root_path, class: "logo-text" %>
          </div>

          <!-- 右端アクション群 -->
          <div class="header-actions flex items-center gap-4">
            <!-- 作成ボタン -->
            <div class="relative">
            <button id="new-record-button" class="bg-blue-500 hover:bg-blue-600 text-white rounded-full px-4 py-2 flex items-center gap-2 shadow-md transition duration-200">
              <i class="fa fa-plus"></i>
             作成
            </button>

              <!-- ドロップダウン -->
             <div id="record-icons" class="absolute right-0 mt-2 hidden bg-white border rounded shadow-md w-48 z-50 flex flex-col gap-2 p-2">
                <%= link_to new_child_feed_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Feed
                <% end %>
                <%= link_to new_child_diaper_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Diaper
                <% end %>
                <%= link_to new_child_bottle_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Bottle
                <% end %>
                <%= link_to new_child_hydration_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Hydration
                <% end %>
                <%= link_to new_child_baby_food_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Baby_food
                <% end %>
                <%= link_to new_child_sleep_record_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Sleep_record
                <% end %>
                <%= link_to new_child_bath_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Bath
                <% end %>
               <%= link_to new_child_temperature_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Temperature
                <% end %>
               <%= link_to new_child_vaccination_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  vaccination
                <% end %>
                <%= link_to new_schedule_path, data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Schedule  
                <% end %>
                <%= link_to new_child_growth_path(current_child), data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Growth
                <% end %>
                <%= link_to new_diary_path, data: { turbo_frame: "modal" }, class: "px-2 py-1 hover:bg-gray-100 rounded" do %>
                  Diary
                <% end %>
              </div>          
            </div>
            
            <!-- 通知ベル -->
            <div class="notification">
              <% if current_child.present? %>
                <%= link_to notifications_path(current_child), class: "notification-link" do %>
                  <i class="fa fa-bell"></i>
                  <% if current_child.notifications.where(read: false).exists? %>
                    <span class="notification-count">
                      <%= current_child.notifications.where(read: false).count %>
                    </span>
                  <% end %>
                <% end %>
              <% end %>
            </div>

            <!-- アカウントアイコン -->
            <div class="account relative">
             <button id="account-toggle" class="flex items-center bg-transparent border-none p-0 focus:outline-none cursor-pointer">
                <% if current_user.avatar.attached? %>
                  <%= image_tag url_for(current_user.avatar), class: "rounded-full w-12 h-12" %>
                <% else %>
                 <svg class="bg-gray-200 rounded-full w-12 h-12" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="gray">
                    <circle cx="12" cy="8" r="4"/>
                    <path d="M12 14c-4 0-6 2-6 4v2h12v-2c0-2-2-4-6-4z"/>
                  </svg>
               <% end %>
             </button>

              <!-- ドロップダウンメニュー -->
              <div id="account-menu" class="absolute right-0 hidden bg-white shadow-md rounded mt-2 w-40 z-50">
                <%= link_to "アカウント設定", edit_user_registration_path, class: "block px-4 py-2 hover:bg-gray-100" %>
                <%= link_to "ログアウト", destroy_user_session_path, method: :delete, class: "block px-4 py-2 hover:bg-gray-100" %>
                <%= link_to "子供を切り替える", switch_child_page_path, class: "block px-4 py-2 hover:bg-gray-100" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <!-- フラッシュ表示用 -->
      <div id="flash-messages">
        <%= render "shared/flash" %>
      </div>
    </header>

    <!-- サイドバー -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <%= render "layouts/sidebar" %>

    <!-- モーダル枠 -->
    <turbo-frame id="modal"></turbo-frame>

    <!-- 通常ページのコンテンツ -->
    <div class="main-content">
      <%= yield %>
    </div>

    <!-- 通知用コンテナ -->
    <div id="notification-container"></div>
  </body>
</html>