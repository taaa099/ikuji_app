<!-- =======================
     通知設定モーダル
     ======================= -->
<div id="notification-modal" class="sidebar-modal hidden">
  <div class="sidebar-modal-content">
    <div id="notification-settings-block" class="hidden">
      <div class="notification-modal-header">
        <span>通知設定</span>
        <button id="close-notification-modal" class="header-close-btn">&times;</button>
      </div>

      <% if current_user.present? %>
        <% current_user.notification_settings.each do |setting| %>
          <div class="notification-setting">
            <h5>
              <% 
                target_name = case setting.target_type
                when "feed" then "授乳"
                when "diaper" then "おむつ"
                when "bottle" then "ミルク"
                when "hydration" then "水分補給"
                when "baby_food" then "離乳食"
                when "sleep_record" then "睡眠"
                when "temperature" then "体温"
                when "bath" then "お風呂"
                when "vaccination" then "予防接種"
                when "schedule" then "スケジュール"
                else setting.target_type.humanize
                end
              %>
              <%= target_name %>
            </h5>

            <% unless setting.target_type == "temperature" %>
              <!-- リマインダーON/OFF -->
              <label class="notification-option">
                <span class="label-text">リマインダーを有効にする</span>
                <%= check_box_tag "reminder_switch_#{setting.id}",
                                  1,
                                  setting.reminder_on,
                                  data: { id: setting.id, field: "reminder_on" },
                                  class: "notification-switch" %>
                <span class="switch-slider"></span>
              </label>

              <% if setting.reminder_after.present? %>
                <label class="notification-option">
                  <% if ["vaccination", "schedule"].include?(setting.target_type) %>
                    <span class="label-text">予定の</span>
                    <%= number_field_tag "reminder_after_#{setting.id}",
                                        setting.reminder_after,
                                        min: 1,
                                        max: 30,
                                        data: { id: setting.id, field: "reminder_after" },
                                        class: "notification-number" %>
                    <span class="label-text">日前に通知</span>
                  <% else %>
                    <span class="label-text">記録から</span>
                    <%= number_field_tag "reminder_after_#{setting.id}",
                                        setting.reminder_after,
                                        min: 1,
                                        max: 12,
                                        data: { id: setting.id, field: "reminder_after" },
                                        class: "notification-number" %>
                    <span class="label-text">時間後に通知</span>
                  <% end %>
                </label>
              <% end %>
            <% end %>

            <!-- アラートON/OFF -->
            <label class="notification-option">
              <span class="label-text">アラートを有効にする</span>
              <%= check_box_tag "alert_switch_#{setting.id}",
                                1,
                                setting.alert_on,
                                data: { id: setting.id, field: "alert_on" },
                                class: "notification-switch" %>
              <span class="switch-slider"></span>
            </label>

            <% if setting.alert_after.present? && !["bottle", "hydration"].include?(setting.target_type) %>
              <label class="notification-option">
                <span class="label-text">記録から</span>
                <%= number_field_tag "alert_after_#{setting.id}",
                                     setting.alert_after,
                                     min: 1,
                                     max: 6,
                                     data: { id: setting.id, field: "alert_after" },
                                     class: "notification-number" %>
                <span class="label-text">時間後にアラート</span>
              </label>
            <% end %>

            <% if setting.alert_threshold.present? %>
              <label class="notification-option">
                <span class="label-text">アラート：</span>
                <%= number_field_tag "alert_threshold_#{setting.id}",
                                     setting.alert_threshold,
                                     step: 0.1,
                                     min: 35.0,
                                     max: 42.0,
                                     data: { id: setting.id, field: "alert_threshold" },
                                     class: "notification-number" %>
                <span class="label-text">℃ 以上で通知</span>
              </label>
            <% end %>

            <% if setting.alert_time.present? %>
              <label class="notification-option">
                <span class="label-text">当日の</span>
                <select name="alert_time_<%= setting.id %>"
                        data-id="<%= setting.id %>"
                        data-field="alert_time"
                        class="notification-number">
                  <% (6..11).each do |h| %>
                    <option value="<%= "%02d:00" % h %>" 
                      <%= "selected" if setting.alert_time&.strftime("%H:%M") == "%02d:00" % h %>>
                      <%= "%02d:00" % h %>
                    </option>
                  <% end %>
                </select>
                <span class="label-text">に通知</span>
              </label>
            <% end %>

            <% if current_child.present? %>
              <% case setting.target_type %>
              <% when "bottle" %>
                <label class="notification-option">
                  <span class="label-text">1日のミルク目標量</span>
                  <%= number_field_tag "daily_bottle_goal_#{current_child.id}",
                                       current_child.daily_bottle_goal,
                                       min: 0,
                                       step: 10,
                                       data: { child_id: current_child.id, field: "daily_bottle_goal" },
                                       class: "child-goal" %>
                  <span class="label-text">（ml）</span>
                </label>
              <% when "hydration" %>
                <label class="notification-option">
                  <span class="label-text">1日の水分摂取目標</span>
                  <%= number_field_tag "daily_hydration_goal_#{current_child.id}",
                                       current_child.daily_hydration_goal,
                                       min: 0,
                                       step: 10,
                                       data: { child_id: current_child.id, field: "daily_hydration_goal" },
                                       class: "child-goal" %>
                  <span class="label-text">（ml）</span>
                </label>
              <% when "baby_food" %>
                <label class="notification-option">
                  <span class="label-text">1日の離乳食目標回数</span>
                  <%= number_field_tag "daily_baby_food_goal_#{current_child.id}",
                                       current_child.daily_baby_food_goal,
                                       min: 0,
                                       step: 1,
                                       data: { child_id: current_child.id, field: "daily_baby_food_goal" },
                                       class: "child-goal" %>
                  <span class="label-text">回</span>
                </label>
              <% end %>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>